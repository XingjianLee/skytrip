# ğŸ”§ é—®é¢˜ä¿®å¤è¯´æ˜

## ä¿®å¤çš„é—®é¢˜åˆ—è¡¨

### 1. âœ… å¤–é”®çº¦æŸé”™è¯¯ - Agency æ¨¡å‹ç¼ºå¤±

**é—®é¢˜**ï¼š
```
sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'users.agency_id' could not find table 'agencies'
```

**åŸå› **ï¼š`users` è¡¨å¼•ç”¨äº† `agencies` è¡¨ï¼Œä½† SQLAlchemy ä¸­æ²¡æœ‰å®šä¹‰ `Agency` æ¨¡å‹ã€‚

**ä¿®å¤**ï¼š
- åˆ›å»ºäº† `app/models/agency.py` æ–‡ä»¶ï¼Œå®šä¹‰äº† `Agency` æ¨¡å‹
- å°† `Agency` æ·»åŠ åˆ° `app/models/__init__.py` ä¸­
- ä¿®å¤äº† `User` æ¨¡å‹ä¸­çš„å¤–é”®å®šä¹‰ï¼Œå…è®¸ `agency_id` ä¸º NULL

### 2. âœ… èˆªç­åˆ›å»ºæ—¶çš„å¤–é”®éªŒè¯

**é—®é¢˜**ï¼š
```
IntegrityError: Cannot add or update a child row: a foreign key constraint fails (flights, CONSTRAINT flights_ibfk_1 FOREIGN KEY (airline_code) REFERENCES airlines (airline_code))
```

**åŸå› **ï¼šåˆ›å»ºèˆªç­æ—¶ï¼Œ`airline_code` å€¼åœ¨ `airlines` è¡¨ä¸­ä¸å­˜åœ¨ã€‚

**ä¿®å¤**ï¼š
- åœ¨ `app/api/v1/flights.py` çš„ `create_flight` å‡½æ•°ä¸­æ·»åŠ äº†éªŒè¯
- æ£€æŸ¥ `airline_code` æ˜¯å¦å­˜åœ¨
- æ£€æŸ¥ `route_id` æ˜¯å¦å­˜åœ¨
- å¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›å‹å¥½çš„é”™è¯¯ä¿¡æ¯

**å¯ç”¨çš„èˆªç©ºå…¬å¸ä»£ç **ï¼š
- CA, MU, CZ, 3U, 9C, HO, JD, KN

### 3. âœ… è®¢å•ç®¡ç†ç•Œé¢åŠ è½½é—®é¢˜

**é—®é¢˜**ï¼šè®¢å•ç®¡ç†ç•Œé¢åŠ è½½ä¸å‡ºæ¥æ•°æ®ã€‚

**åŸå› **ï¼šåç«¯è¿”å›çš„æ˜¯ `OrderListResponse` å¯¹è±¡ï¼ˆåŒ…å« `items` æ•°ç»„ï¼‰ï¼Œä½†å‰ç«¯æœŸæœ›ç›´æ¥æ˜¯æ•°ç»„ã€‚

**ä¿®å¤**ï¼š
- ä¿®æ”¹äº† `admin-frontend/src/views/OrdersPage.vue`
- é€‚é…æ–°çš„å“åº”æ ¼å¼ï¼š`response.items || response`

### 4. âœ… èˆªç­åˆ é™¤æ“ä½œæ— æ³•æ‰§è¡Œ

**é—®é¢˜**ï¼šåˆ é™¤æŒ‰é’®ç‚¹å‡»åæ²¡æœ‰ååº”ã€‚

**åŸå› **ï¼š`handleDelete` å‡½æ•°è¿”å›äº†ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œè€Œä¸æ˜¯ç›´æ¥æ‰§è¡Œã€‚

**ä¿®å¤**ï¼š
- ä¿®æ”¹äº† `admin-frontend/src/views/FlightsPage.vue`
- å°† `handleDelete` æ”¹ä¸ºç›´æ¥æ‰§è¡Œå¼‚æ­¥æ“ä½œ
- æ·»åŠ äº†é”™è¯¯å¤„ç†

### 5. âœ… é…’åº—ç®¡ç†ç¼–è¾‘ã€æ–°å¢æ“ä½œæ— æ³•æ‰§è¡Œ

**é—®é¢˜**ï¼šé…’åº—çš„æ–°å¢å’Œç¼–è¾‘æ“ä½œå¤±è´¥ã€‚

**å¯èƒ½åŸå› **ï¼š
- å¿…å¡«å­—æ®µéªŒè¯
- é”™è¯¯å¤„ç†ä¸å®Œå–„

**ä¿®å¤**ï¼š
- åœ¨ `admin-frontend/src/views/HotelsPage.vue` ä¸­æ·»åŠ äº†å¿…å¡«å­—æ®µéªŒè¯
- æ·»åŠ äº†é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º
- ä¿®å¤äº† `CrudPanel` ç»„ä»¶çš„å¼‚æ­¥å¤„ç†

### 6. âœ… æ™¯ç‚¹ç®¡ç†æ–°å¢ã€ç¼–è¾‘æ“ä½œæ— æ³•æ‰§è¡Œ

**é—®é¢˜**ï¼šæ™¯ç‚¹çš„æ–°å¢å’Œç¼–è¾‘æ“ä½œå¤±è´¥ã€‚

**ä¿®å¤**ï¼š
- åœ¨ `admin-frontend/src/views/ScenicSpotsPage.vue` ä¸­æ·»åŠ äº†å¿…å¡«å­—æ®µéªŒè¯
- æ·»åŠ äº†é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

### 7. âœ… ç”¨æˆ·ç®¡ç†çŠ¶æ€æ§åˆ¶æ“ä½œæ— æ³•å®ç°

**é—®é¢˜**ï¼š
```
sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'users.agency_id' could not find table 'agencies'
```

**åŸå› **ï¼šä¸é—®é¢˜ 1 ç›¸åŒï¼Œç¼ºå°‘ `Agency` æ¨¡å‹ã€‚

**ä¿®å¤**ï¼š
- é€šè¿‡åˆ›å»º `Agency` æ¨¡å‹è§£å†³
- åœ¨ `admin-frontend/src/views/UsersPage.vue` ä¸­æ·»åŠ äº†é”™è¯¯å¤„ç†

### 8. âœ… é€šçŸ¥ä¸­å¿ƒåˆ é™¤æ“ä½œæ— æ³•å®ç°

**é—®é¢˜**ï¼šåˆ é™¤æŒ‰é’®ç‚¹å‡»åæ²¡æœ‰ååº”ã€‚

**åŸå› **ï¼šä¸èˆªç­åˆ é™¤ç›¸åŒï¼Œå‡½æ•°å®šä¹‰æœ‰é—®é¢˜ã€‚

**ä¿®å¤**ï¼š
- ä¿®æ”¹äº† `admin-frontend/src/views/NotificationsPage.vue`
- å°† `handleDelete` æ”¹ä¸ºç›´æ¥æ‰§è¡Œå¼‚æ­¥æ“ä½œ
- æ·»åŠ äº†é”™è¯¯å¤„ç†

## ä¿®å¤çš„æ–‡ä»¶æ¸…å•

### åç«¯æ–‡ä»¶

1. **app/models/agency.py** - æ–°å»ºï¼Œå®šä¹‰ Agency æ¨¡å‹
2. **app/models/__init__.py** - æ·»åŠ  Agency å¯¼å…¥
3. **app/models/user.py** - ä¿®å¤å¤–é”®å®šä¹‰ï¼ˆå…è®¸ NULLï¼‰
4. **app/api/v1/flights.py** - æ·»åŠ å¤–é”®éªŒè¯

### å‰ç«¯æ–‡ä»¶

1. **admin-frontend/src/views/OrdersPage.vue** - ä¿®å¤è®¢å•åˆ—è¡¨åŠ è½½
2. **admin-frontend/src/views/FlightsPage.vue** - ä¿®å¤åˆ é™¤æ“ä½œ
3. **admin-frontend/src/views/HotelsPage.vue** - ä¿®å¤åˆ›å»º/ç¼–è¾‘æ“ä½œ
4. **admin-frontend/src/views/ScenicSpotsPage.vue** - ä¿®å¤åˆ›å»º/ç¼–è¾‘æ“ä½œ
5. **admin-frontend/src/views/UsersPage.vue** - ä¿®å¤çŠ¶æ€åˆ‡æ¢é”™è¯¯å¤„ç†
6. **admin-frontend/src/views/NotificationsPage.vue** - ä¿®å¤åˆ é™¤æ“ä½œ
7. **admin-frontend/src/views/components/CrudPanel.vue** - ä¿®å¤å¼‚æ­¥å¤„ç†

## æµ‹è¯•å»ºè®®

ä¿®å¤åï¼Œè¯·æµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **èˆªç­ç®¡ç†**ï¼š
   - âœ… åˆ›å»ºèˆªç­ï¼ˆä½¿ç”¨æœ‰æ•ˆçš„ airline_codeï¼Œå¦‚ï¼šCA, MU, CZï¼‰
   - âœ… ç¼–è¾‘èˆªç­
   - âœ… åˆ é™¤èˆªç­

2. **é…’åº—ç®¡ç†**ï¼š
   - âœ… åˆ›å»ºé…’åº—ï¼ˆå¿…é¡»å¡«å†™åç§°å’ŒåŸå¸‚ï¼‰
   - âœ… ç¼–è¾‘é…’åº—
   - âœ… åˆ é™¤é…’åº—

3. **æ™¯ç‚¹ç®¡ç†**ï¼š
   - âœ… åˆ›å»ºæ™¯ç‚¹ï¼ˆå¿…é¡»å¡«å†™åç§°å’ŒåŸå¸‚ï¼‰
   - âœ… ç¼–è¾‘æ™¯ç‚¹
   - âœ… åˆ é™¤æ™¯ç‚¹

4. **ç”¨æˆ·ç®¡ç†**ï¼š
   - âœ… å†»ç»“/è§£å†»ç”¨æˆ·

5. **é€šçŸ¥ç®¡ç†**ï¼š
   - âœ… å‘é€é€šçŸ¥
   - âœ… åˆ é™¤é€šçŸ¥

6. **è®¢å•ç®¡ç†**ï¼š
   - âœ… æŸ¥çœ‹è®¢å•åˆ—è¡¨
   - âœ… æŸ¥çœ‹è®¢å•è¯¦æƒ…
   - âœ… ä¿®æ”¹è®¢å•çŠ¶æ€

## æ³¨æ„äº‹é¡¹

1. **åˆ›å»ºèˆªç­æ—¶**ï¼š
   - `airline_code` å¿…é¡»æ˜¯å·²å­˜åœ¨çš„èˆªç©ºå…¬å¸ä»£ç ï¼ˆCA, MU, CZ, 3U, 9C, HO, JD, KNï¼‰
   - `route_id` å¿…é¡»æ˜¯å·²å­˜åœ¨çš„èˆªçº¿ ID

2. **åˆ›å»ºé…’åº—/æ™¯ç‚¹æ—¶**ï¼š
   - `name` å’Œ `city` æ˜¯å¿…å¡«å­—æ®µ

3. **å¦‚æœä»æœ‰é—®é¢˜**ï¼š
   - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰çš„é”™è¯¯ä¿¡æ¯
   - æ£€æŸ¥åç«¯æ—¥å¿—
   - ç¡®è®¤æ•°æ®åº“ä¸­æœ‰ç›¸åº”çš„åŸºç¡€æ•°æ®ï¼ˆairlines, routes ç­‰ï¼‰

